<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DataFlow AI ‚Äî Intelligent Pipeline Automation</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #050a0f;
    --surface: #0a1520;
    --surface2: #0f1f30;
    --border: #1a3a55;
    --accent: #00d4ff;
    --accent2: #00ff9d;
    --accent3: #ff6b35;
    --warn: #ffbe0b;
    --text: #e8f4ff;
    --muted: #4a7a9b;
    --danger: #ff4757;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Grid background */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,212,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,212,255,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  /* Glow orbs */
  .orb {
    position: fixed;
    border-radius: 50%;
    filter: blur(80px);
    pointer-events: none;
    z-index: 0;
  }
  .orb-1 { width: 400px; height: 400px; background: rgba(0,212,255,0.08); top: -100px; left: -100px; }
  .orb-2 { width: 300px; height: 300px; background: rgba(0,255,157,0.06); bottom: 100px; right: -50px; }
  .orb-3 { width: 200px; height: 200px; background: rgba(255,107,53,0.05); top: 50%; left: 50%; }

  nav {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(5,10,15,0.85);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border);
    padding: 0 2rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 56px;
  }

  .nav-brand {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1.1rem;
    font-weight: 800;
    letter-spacing: -0.02em;
  }

  .nav-brand .dot {
    width: 8px; height: 8px;
    background: var(--accent);
    border-radius: 50%;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.3); }
  }

  .nav-tabs {
    display: flex;
    gap: 0.25rem;
  }

  .nav-tab {
    padding: 0.35rem 0.85rem;
    border-radius: 6px;
    font-size: 0.78rem;
    font-weight: 600;
    cursor: pointer;
    border: none;
    background: transparent;
    color: var(--muted);
    transition: all 0.2s;
    font-family: 'Syne', sans-serif;
    letter-spacing: 0.02em;
  }

  .nav-tab:hover { color: var(--text); background: var(--surface); }
  .nav-tab.active { color: var(--accent); background: rgba(0,212,255,0.1); border: 1px solid rgba(0,212,255,0.2); }

  .nav-status {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.72rem;
    color: var(--accent2);
    font-family: 'Space Mono', monospace;
  }

  .status-dot {
    width: 6px; height: 6px;
    background: var(--accent2);
    border-radius: 50%;
    animation: pulse 1.5s infinite;
  }

  main {
    position: relative;
    z-index: 1;
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
  }

  /* TABS CONTENT */
  .tab-content { display: none; }
  .tab-content.active { display: block; animation: fadeIn 0.3s ease; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

  /* DASHBOARD */
  .hero {
    margin-bottom: 2rem;
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .hero h1 {
    font-size: 2.2rem;
    font-weight: 800;
    line-height: 1.1;
    letter-spacing: -0.03em;
  }

  .hero h1 span { color: var(--accent); }

  .hero p { color: var(--muted); font-size: 0.9rem; margin-top: 0.4rem; }

  .run-btn {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    color: #000;
    border: none;
    padding: 0.6rem 1.5rem;
    border-radius: 8px;
    font-weight: 700;
    font-size: 0.85rem;
    cursor: pointer;
    font-family: 'Syne', sans-serif;
    letter-spacing: 0.02em;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  .run-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(0,212,255,0.3); }
  .run-btn:active { transform: translateY(0); }

  /* Stats row */
  .stats-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.2rem;
    position: relative;
    overflow: hidden;
    transition: border-color 0.2s;
  }

  .stat-card:hover { border-color: var(--accent); }

  .stat-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
  }

  .stat-card.blue::before { background: var(--accent); }
  .stat-card.green::before { background: var(--accent2); }
  .stat-card.orange::before { background: var(--accent3); }
  .stat-card.yellow::before { background: var(--warn); }

  .stat-label {
    font-size: 0.7rem;
    color: var(--muted);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    margin-bottom: 0.5rem;
  }

  .stat-value {
    font-size: 1.8rem;
    font-weight: 800;
    letter-spacing: -0.03em;
    line-height: 1;
  }

  .stat-card.blue .stat-value { color: var(--accent); }
  .stat-card.green .stat-value { color: var(--accent2); }
  .stat-card.orange .stat-value { color: var(--accent3); }
  .stat-card.yellow .stat-value { color: var(--warn); }

  .stat-sub {
    font-size: 0.72rem;
    color: var(--muted);
    margin-top: 0.3rem;
    font-family: 'Space Mono', monospace;
  }

  .stat-badge {
    display: inline-block;
    padding: 0.15rem 0.4rem;
    border-radius: 4px;
    font-size: 0.65rem;
    font-weight: 700;
    margin-top: 0.3rem;
  }

  .badge-up { background: rgba(0,255,157,0.15); color: var(--accent2); }
  .badge-down { background: rgba(255,71,87,0.15); color: var(--danger); }
  .badge-warn { background: rgba(255,190,11,0.15); color: var(--warn); }

  /* Two column layout */
  .two-col {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .three-col {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.4rem;
  }

  .card-title {
    font-size: 0.72rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--muted);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .card-title span { color: var(--accent); font-family: 'Space Mono', monospace; font-size: 0.7rem; }

  /* Pipeline list */
  .pipeline-item {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    padding: 0.7rem 0;
    border-bottom: 1px solid rgba(26,58,85,0.5);
    cursor: pointer;
    transition: all 0.15s;
  }

  .pipeline-item:last-child { border-bottom: none; }
  .pipeline-item:hover { padding-left: 0.3rem; }

  .pipeline-icon {
    width: 32px; height: 32px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    flex-shrink: 0;
  }

  .pi-blue { background: rgba(0,212,255,0.1); }
  .pi-green { background: rgba(0,255,157,0.1); }
  .pi-orange { background: rgba(255,107,53,0.1); }
  .pi-yellow { background: rgba(255,190,11,0.1); }

  .pipeline-info { flex: 1; }
  .pipeline-name { font-size: 0.82rem; font-weight: 600; }
  .pipeline-meta { font-size: 0.68rem; color: var(--muted); font-family: 'Space Mono', monospace; }

  .pipeline-status {
    font-size: 0.65rem;
    padding: 0.2rem 0.5rem;
    border-radius: 20px;
    font-weight: 700;
    white-space: nowrap;
  }

  .ps-running { background: rgba(0,212,255,0.15); color: var(--accent); }
  .ps-success { background: rgba(0,255,157,0.15); color: var(--accent2); }
  .ps-failed { background: rgba(255,71,87,0.15); color: var(--danger); }
  .ps-queued { background: rgba(255,190,11,0.15); color: var(--warn); }

  /* Anomaly feed */
  .anomaly-item {
    display: flex;
    gap: 0.8rem;
    padding: 0.7rem 0;
    border-bottom: 1px solid rgba(26,58,85,0.4);
  }

  .anomaly-item:last-child { border-bottom: none; }

  .anomaly-icon {
    width: 28px; height: 28px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    flex-shrink: 0;
    margin-top: 2px;
  }

  .ai-label {
    font-size: 0.6rem;
    background: rgba(0,212,255,0.1);
    color: var(--accent);
    border: 1px solid rgba(0,212,255,0.2);
    padding: 0.1rem 0.35rem;
    border-radius: 3px;
    font-weight: 700;
    display: inline-block;
    margin-bottom: 0.2rem;
  }

  .anomaly-text { font-size: 0.78rem; color: var(--text); }
  .anomaly-time { font-size: 0.65rem; color: var(--muted); font-family: 'Space Mono', monospace; }

  /* Throughput chart */
  .chart-area {
    height: 90px;
    position: relative;
    margin-top: 0.5rem;
  }

  .chart-bars {
    display: flex;
    align-items: flex-end;
    gap: 3px;
    height: 100%;
  }

  .chart-bar {
    flex: 1;
    border-radius: 3px 3px 0 0;
    transition: all 0.3s;
    position: relative;
    cursor: pointer;
  }

  .chart-bar:hover { filter: brightness(1.3); }

  /* AI ASSISTANT TAB */
  .ai-chat-container {
    display: grid;
    grid-template-columns: 1fr 340px;
    gap: 1.5rem;
    height: calc(100vh - 160px);
  }

  .chat-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .chat-header {
    padding: 1rem 1.4rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 0.6rem;
  }

  .ai-avatar {
    width: 32px; height: 32px;
    border-radius: 8px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    color: #000;
  }

  .chat-title { font-size: 0.9rem; font-weight: 700; }
  .chat-subtitle { font-size: 0.7rem; color: var(--muted); }

  .chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 1.2rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }

  .msg {
    display: flex;
    gap: 0.7rem;
    animation: fadeIn 0.3s ease;
  }

  .msg.user { flex-direction: row-reverse; }

  .msg-avatar {
    width: 28px; height: 28px;
    border-radius: 7px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
  }

  .msg-avatar.ai-av { background: linear-gradient(135deg, var(--accent), var(--accent2)); color: #000; }
  .msg-avatar.user-av { background: var(--surface2); border: 1px solid var(--border); }

  .msg-bubble {
    max-width: 80%;
    padding: 0.7rem 0.9rem;
    border-radius: 10px;
    font-size: 0.82rem;
    line-height: 1.5;
  }

  .msg.ai .msg-bubble { background: var(--surface2); border: 1px solid var(--border); }
  .msg.user .msg-bubble { background: rgba(0,212,255,0.1); border: 1px solid rgba(0,212,255,0.2); }

  .msg-bubble code {
    background: rgba(0,212,255,0.08);
    border: 1px solid rgba(0,212,255,0.15);
    padding: 0.1rem 0.3rem;
    border-radius: 4px;
    font-family: 'Space Mono', monospace;
    font-size: 0.75rem;
    color: var(--accent);
  }

  .msg-bubble pre {
    background: rgba(0,0,0,0.3);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.8rem;
    margin-top: 0.5rem;
    overflow-x: auto;
    font-family: 'Space Mono', monospace;
    font-size: 0.72rem;
    color: var(--accent2);
    line-height: 1.6;
  }

  .chat-input-area {
    padding: 1rem;
    border-top: 1px solid var(--border);
  }

  .suggestion-chips {
    display: flex;
    gap: 0.4rem;
    flex-wrap: wrap;
    margin-bottom: 0.6rem;
  }

  .chip {
    font-size: 0.68rem;
    padding: 0.25rem 0.6rem;
    border-radius: 20px;
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--muted);
    cursor: pointer;
    transition: all 0.15s;
    font-family: 'Syne', sans-serif;
  }

  .chip:hover { border-color: var(--accent); color: var(--accent); background: rgba(0,212,255,0.05); }

  .input-row {
    display: flex;
    gap: 0.5rem;
  }

  .chat-input {
    flex: 1;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.6rem 0.9rem;
    color: var(--text);
    font-family: 'Syne', sans-serif;
    font-size: 0.82rem;
    outline: none;
    transition: border-color 0.2s;
  }

  .chat-input:focus { border-color: var(--accent); }
  .chat-input::placeholder { color: var(--muted); }

  .send-btn {
    background: var(--accent);
    color: #000;
    border: none;
    border-radius: 8px;
    padding: 0.6rem 1rem;
    cursor: pointer;
    font-weight: 700;
    font-size: 0.8rem;
    font-family: 'Syne', sans-serif;
    transition: all 0.15s;
    display: flex;
    align-items: center;
    gap: 0.3rem;
  }

  .send-btn:hover { background: #33ddff; transform: translateY(-1px); }
  .send-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  /* Context panel */
  .context-panel {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  /* PIPELINE BUILDER */
  .builder-layout {
    display: grid;
    grid-template-columns: 220px 1fr 260px;
    gap: 1.5rem;
    height: calc(100vh - 160px);
  }

  .node-palette {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1rem;
    overflow-y: auto;
  }

  .palette-section {
    margin-bottom: 1.2rem;
  }

  .palette-label {
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--muted);
    margin-bottom: 0.5rem;
  }

  .palette-node {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.7rem;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    margin-bottom: 0.4rem;
    cursor: grab;
    font-size: 0.76rem;
    transition: all 0.15s;
  }

  .palette-node:hover { border-color: var(--accent); background: rgba(0,212,255,0.05); }

  .palette-node .pn-icon {
    width: 22px; height: 22px;
    border-radius: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    flex-shrink: 0;
  }

  .canvas-area {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    position: relative;
    overflow: hidden;
  }

  .canvas-header {
    padding: 0.8rem 1.2rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 0.75rem;
    color: var(--muted);
  }

  .canvas-inner {
    width: 100%;
    height: calc(100% - 44px);
    position: relative;
    overflow: hidden;
  }

  /* Pipeline nodes on canvas */
  .pipeline-canvas {
    position: absolute;
    inset: 0;
    padding: 2rem;
    display: flex;
    align-items: center;
    gap: 0;
  }

  .pipeline-flow {
    display: flex;
    align-items: center;
    gap: 0;
    width: 100%;
  }

  .p-node {
    background: var(--surface2);
    border: 2px solid var(--border);
    border-radius: 12px;
    padding: 0.8rem 1rem;
    min-width: 120px;
    text-align: center;
    position: relative;
    cursor: pointer;
    transition: all 0.2s;
    flex-shrink: 0;
  }

  .p-node:hover, .p-node.selected { border-color: var(--accent); box-shadow: 0 0 20px rgba(0,212,255,0.15); }
  .p-node.running { border-color: var(--accent); animation: nodePulse 1.5s infinite; }
  .p-node.success { border-color: var(--accent2); }
  .p-node.failed { border-color: var(--danger); }

  @keyframes nodePulse {
    0%, 100% { box-shadow: 0 0 0 rgba(0,212,255,0.3); }
    50% { box-shadow: 0 0 20px rgba(0,212,255,0.3); }
  }

  .p-node-icon { font-size: 1.3rem; margin-bottom: 0.3rem; }
  .p-node-name { font-size: 0.72rem; font-weight: 600; }
  .p-node-type { font-size: 0.62rem; color: var(--muted); }

  .p-node-status-dot {
    position: absolute;
    top: -4px; right: -4px;
    width: 10px; height: 10px;
    border-radius: 50%;
    border: 2px solid var(--surface2);
  }

  .psd-running { background: var(--accent); animation: pulse 1s infinite; }
  .psd-success { background: var(--accent2); }
  .psd-failed { background: var(--danger); }
  .psd-idle { background: var(--muted); }

  .p-arrow {
    flex: 1;
    display: flex;
    align-items: center;
    padding: 0 0.5rem;
    min-width: 30px;
  }

  .p-arrow-line {
    flex: 1;
    height: 2px;
    background: linear-gradient(90deg, var(--border), rgba(0,212,255,0.3));
    position: relative;
  }

  .p-arrow-line.active {
    background: linear-gradient(90deg, var(--accent2), var(--accent));
    animation: flowAnim 1.5s infinite linear;
  }

  @keyframes flowAnim {
    0% { background-position: 0% 50%; }
    100% { background-position: 100% 50%; }
  }

  .p-arrow-head {
    width: 0; height: 0;
    border-top: 5px solid transparent;
    border-bottom: 5px solid transparent;
    border-left: 8px solid var(--border);
    flex-shrink: 0;
  }

  .p-arrow-line.active + .p-arrow-head { border-left-color: var(--accent); }

  /* Config panel */
  .config-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.2rem;
    overflow-y: auto;
  }

  .config-title { font-size: 0.8rem; font-weight: 700; margin-bottom: 1rem; }

  .config-field {
    margin-bottom: 1rem;
  }

  .config-label {
    font-size: 0.68rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.07em;
    margin-bottom: 0.3rem;
  }

  .config-input {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 7px;
    padding: 0.5rem 0.7rem;
    color: var(--text);
    font-family: 'Space Mono', monospace;
    font-size: 0.75rem;
    outline: none;
    transition: border-color 0.2s;
  }

  .config-input:focus { border-color: var(--accent); }

  .config-select {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 7px;
    padding: 0.5rem 0.7rem;
    color: var(--text);
    font-family: 'Space Mono', monospace;
    font-size: 0.75rem;
    outline: none;
    cursor: pointer;
  }

  .ai-suggest-btn {
    width: 100%;
    background: rgba(0,212,255,0.08);
    border: 1px solid rgba(0,212,255,0.2);
    border-radius: 7px;
    padding: 0.6rem;
    color: var(--accent);
    font-size: 0.75rem;
    cursor: pointer;
    font-family: 'Syne', sans-serif;
    font-weight: 600;
    transition: all 0.2s;
    margin-top: 0.5rem;
  }

  .ai-suggest-btn:hover { background: rgba(0,212,255,0.15); }

  /* ANALYTICS TAB */
  .analytics-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .metric-ring {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0.5rem 0;
  }

  .ring-svg { transform: rotate(-90deg); }
  .ring-bg { stroke: var(--surface2); }
  .ring-fill { stroke-linecap: round; transition: stroke-dashoffset 1s ease; }

  .ring-center {
    text-align: center;
    position: absolute;
  }

  .ring-container { position: relative; display: flex; align-items: center; justify-content: center; }

  .ring-val { font-size: 1.3rem; font-weight: 800; display: block; }
  .ring-lbl { font-size: 0.65rem; color: var(--muted); display: block; }

  /* Log view */
  .log-area {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.8rem;
    font-family: 'Space Mono', monospace;
    font-size: 0.7rem;
    height: 180px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }

  .log-line { margin-bottom: 0.2rem; display: flex; gap: 0.8rem; }
  .log-time { color: var(--muted); flex-shrink: 0; }
  .log-info { color: var(--accent); }
  .log-warn { color: var(--warn); }
  .log-error { color: var(--danger); }
  .log-success { color: var(--accent2); }

  /* Loading spinner */
  .spinner {
    display: inline-block;
    width: 12px; height: 12px;
    border: 2px solid rgba(0,212,255,0.2);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  /* Typing indicator */
  .typing {
    display: flex;
    gap: 4px;
    align-items: center;
    padding: 0.3rem 0;
  }

  .typing span {
    width: 6px; height: 6px;
    background: var(--muted);
    border-radius: 50%;
    animation: typing 1.2s infinite;
  }

  .typing span:nth-child(2) { animation-delay: 0.2s; }
  .typing span:nth-child(3) { animation-delay: 0.4s; }

  @keyframes typing {
    0%, 60%, 100% { transform: translateY(0); opacity: 0.3; }
    30% { transform: translateY(-4px); opacity: 1; }
  }

  /* Responsive */
  @media (max-width: 900px) {
    .stats-row { grid-template-columns: 1fr 1fr; }
    .two-col, .three-col { grid-template-columns: 1fr; }
    .builder-layout, .ai-chat-container { grid-template-columns: 1fr; }
  }

  .toggle {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.72rem;
    color: var(--muted);
    cursor: pointer;
  }

  .toggle-switch {
    width: 32px; height: 18px;
    background: var(--accent);
    border-radius: 9px;
    position: relative;
  }

  .toggle-switch::after {
    content: '';
    position: absolute;
    width: 12px; height: 12px;
    border-radius: 50%;
    background: #000;
    top: 3px; right: 3px;
    transition: 0.2s;
  }

  .full-col { grid-column: 1 / -1; }
</style>
</head>
<body>

<div class="orb orb-1"></div>
<div class="orb orb-2"></div>
<div class="orb orb-3"></div>

<nav>
  <div class="nav-brand">
    <div class="dot"></div>
    DataFlow<span style="color:var(--accent)">AI</span>
  </div>
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="switchTab('dashboard')">Dashboard</button>
    <button class="nav-tab" onclick="switchTab('pipelines')">Pipeline Builder</button>
    <button class="nav-tab" onclick="switchTab('ai')">AI Assistant</button>
    <button class="nav-tab" onclick="switchTab('analytics')">Analytics</button>
  </div>
  <div class="nav-status">
    <div class="status-dot"></div>
    3 pipelines running
  </div>
</nav>

<main>

  <!-- ===== DASHBOARD TAB ===== -->
  <div class="tab-content active" id="tab-dashboard">
    <div class="hero">
      <div>
        <h1>Data Pipeline<br><span>Intelligence Hub</span></h1>
        <p>AI-powered monitoring ¬∑ anomaly detection ¬∑ auto-healing pipelines</p>
      </div>
      <button class="run-btn" onclick="triggerRun()">
        ‚ñ∂ Run All Pipelines
      </button>
    </div>

    <div class="stats-row">
      <div class="stat-card blue">
        <div class="stat-label">Records Processed Today</div>
        <div class="stat-value" id="stat-records">2.4M</div>
        <div class="stat-sub">last sync: 2 min ago</div>
        <div class="stat-badge badge-up">‚Üë +18% vs yesterday</div>
      </div>
      <div class="stat-card green">
        <div class="stat-label">Pipeline Success Rate</div>
        <div class="stat-value">98.7%</div>
        <div class="stat-sub">last 24h window</div>
        <div class="stat-badge badge-up">‚Üë 99.2% SLA target</div>
      </div>
      <div class="stat-card orange">
        <div class="stat-label">Avg. Transform Latency</div>
        <div class="stat-value">143ms</div>
        <div class="stat-sub">p95: 389ms ¬∑ p99: 712ms</div>
        <div class="stat-badge badge-up">‚Üì -22ms improved</div>
      </div>
      <div class="stat-card yellow">
        <div class="stat-label">AI Anomalies Caught</div>
        <div class="stat-value" id="stat-anomalies">7</div>
        <div class="stat-sub">3 auto-resolved ¬∑ 4 flagged</div>
        <div class="stat-badge badge-warn">‚ö° 2 need review</div>
      </div>
    </div>

    <div class="three-col">
      <div class="card">
        <div class="card-title">Active Pipelines <span id="pipeline-count">5 active</span></div>
        <div id="pipeline-list">
          <div class="pipeline-item">
            <div class="pipeline-icon pi-blue">üîÑ</div>
            <div class="pipeline-info">
              <div class="pipeline-name">Sales CRM ‚Üí Data Warehouse</div>
              <div class="pipeline-meta">Salesforce ‚Üí Snowflake ¬∑ 12,400 rec/min</div>
            </div>
            <span class="pipeline-status ps-running">‚óè RUNNING</span>
          </div>
          <div class="pipeline-item">
            <div class="pipeline-icon pi-green">‚úì</div>
            <div class="pipeline-info">
              <div class="pipeline-name">Shopify Orders ETL</div>
              <div class="pipeline-meta">REST API ‚Üí BigQuery ¬∑ last: 4 min ago</div>
            </div>
            <span class="pipeline-status ps-success">‚úì SUCCESS</span>
          </div>
          <div class="pipeline-item">
            <div class="pipeline-icon pi-orange">‚öô</div>
            <div class="pipeline-info">
              <div class="pipeline-name">Event Stream Analytics</div>
              <div class="pipeline-meta">Kafka ‚Üí Redshift ¬∑ 88k events/sec</div>
            </div>
            <span class="pipeline-status ps-running">‚óè RUNNING</span>
          </div>
          <div class="pipeline-item">
            <div class="pipeline-icon pi-yellow">‚è≥</div>
            <div class="pipeline-info">
              <div class="pipeline-name">Daily Finance Reconciliation</div>
              <div class="pipeline-meta">Postgres ‚Üí S3 ¬∑ scheduled 2:00 AM</div>
            </div>
            <span class="pipeline-status ps-queued">‚óå QUEUED</span>
          </div>
          <div class="pipeline-item">
            <div class="pipeline-icon pi-blue">üîÑ</div>
            <div class="pipeline-info">
              <div class="pipeline-name">ML Feature Store Sync</div>
              <div class="pipeline-meta">dbt ‚Üí Feature Store ¬∑ 5 min interval</div>
            </div>
            <span class="pipeline-status ps-running">‚óè RUNNING</span>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">AI Anomaly Detection <span>LIVE</span></div>
        <div>
          <div class="anomaly-item">
            <div class="anomaly-icon" style="background:rgba(255,71,87,0.1)">üî¥</div>
            <div>
              <div class="ai-label">AI FLAGGED</div>
              <div class="anomaly-text">Sales pipeline row count dropped 41% vs. 7-day avg. Possible source schema change.</div>
              <div class="anomaly-time">2 min ago ¬∑ orders_staging</div>
            </div>
          </div>
          <div class="anomaly-item">
            <div class="anomaly-icon" style="background:rgba(255,190,11,0.1)">‚ö°</div>
            <div>
              <div class="ai-label">AI AUTO-FIXED</div>
              <div class="anomaly-text">Null values in customer_id column auto-filled with fallback lookup. 312 rows repaired.</div>
              <div class="anomaly-time">18 min ago ¬∑ crm_events</div>
            </div>
          </div>
          <div class="anomaly-item">
            <div class="anomaly-icon" style="background:rgba(0,255,157,0.1)">‚úì</div>
            <div>
              <div class="ai-label">AI RESOLVED</div>
              <div class="anomaly-text">Duplicate transaction IDs detected and deduplicated. Root cause: upstream retry logic.</div>
              <div class="anomaly-time">1 hr ago ¬∑ payments</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Throughput ‚Äî 24h</div>
        <div class="chart-area">
          <div class="chart-bars" id="throughput-chart"></div>
        </div>
        <div style="display:flex;justify-content:space-between;margin-top:0.4rem;font-size:0.65rem;color:var(--muted);font-family:'Space Mono',monospace">
          <span>00:00</span><span>06:00</span><span>12:00</span><span>18:00</span><span>now</span>
        </div>
      </div>
    </div>

    <div class="two-col">
      <div class="card">
        <div class="card-title">Live Pipeline Logs <span id="log-status">‚óè streaming</span></div>
        <div class="log-area" id="live-logs">
          <div class="log-line"><span class="log-time">14:32:01</span><span class="log-info">[INFO]</span><span>Pipeline 'Sales CRM' started ‚Äî batch_id: b7f2a91</span></div>
          <div class="log-line"><span class="log-time">14:32:03</span><span class="log-info">[INFO]</span><span>Extracted 12,440 records from Salesforce API v54</span></div>
          <div class="log-line"><span class="log-time">14:32:05</span><span class="log-success">[OK]</span><span>Schema validation passed ‚Äî all 47 fields mapped</span></div>
          <div class="log-line"><span class="log-time">14:32:07</span><span class="log-warn">[WARN]</span><span>3 records missing postal_code ‚Äî applying default transform</span></div>
          <div class="log-line"><span class="log-time">14:32:09</span><span class="log-info">[INFO]</span><span>Running dbt model: stg_salesforce_contacts</span></div>
          <div class="log-line"><span class="log-time">14:32:12</span><span class="log-success">[OK]</span><span>12,437 records loaded to Snowflake.PUBLIC.contacts</span></div>
          <div class="log-line"><span class="log-time">14:32:13</span><span class="log-info">[AI]</span><span style="color:var(--accent)">Anomaly check: row count within normal range (¬±2.1œÉ)</span></div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">AI Optimization Suggestions <span>GPT-4o powered</span></div>
        <div>
          <div style="background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:0.8rem;margin-bottom:0.7rem">
            <div style="font-size:0.68rem;color:var(--accent);margin-bottom:0.3rem;font-weight:700">‚ö° PERFORMANCE</div>
            <div style="font-size:0.78rem;line-height:1.5">Adding a <strong>composite index</strong> on (customer_id, event_date) in the events table could reduce Redshift query time by ~67%.</div>
            <button class="ai-suggest-btn" style="margin-top:0.5rem;padding:0.4rem" onclick="applyOptimization(this)">Apply Optimization ‚Üí</button>
          </div>
          <div style="background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:0.8rem;margin-bottom:0.7rem">
            <div style="font-size:0.68rem;color:var(--accent2);margin-bottom:0.3rem;font-weight:700">üí° COST SAVING</div>
            <div style="font-size:0.78rem;line-height:1.5">Archiving 6M+ rows of raw event data older than 90 days to S3 cold storage could save ~$340/mo in Redshift costs.</div>
            <button class="ai-suggest-btn" style="margin-top:0.5rem;padding:0.4rem;border-color:rgba(0,255,157,0.2);color:var(--accent2)" onclick="applyOptimization(this)">Schedule Archive ‚Üí</button>
          </div>
          <div style="background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:0.8rem">
            <div style="font-size:0.68rem;color:var(--warn);margin-bottom:0.3rem;font-weight:700">üîí DATA QUALITY</div>
            <div style="font-size:0.78rem;line-height:1.5">Detected PII fields (email, phone) in <code style="font-family:Space Mono;font-size:0.72rem;background:rgba(255,190,11,0.1);padding:0.1rem 0.3rem;border-radius:3px">raw_leads</code> table. Recommend applying column-level encryption.</div>
            <button class="ai-suggest-btn" style="margin-top:0.5rem;padding:0.4rem;border-color:rgba(255,190,11,0.2);color:var(--warn)" onclick="applyOptimization(this)">Enable Encryption ‚Üí</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== PIPELINE BUILDER TAB ===== -->
  <div class="tab-content" id="tab-pipelines">
    <div class="hero">
      <div>
        <h1>Pipeline <span>Builder</span></h1>
        <p>Drag-and-drop ETL design with AI-assisted node configuration</p>
      </div>
      <div style="display:flex;gap:0.6rem">
        <button class="run-btn" style="background:var(--surface2);color:var(--text);border:1px solid var(--border)" onclick="validatePipeline()">‚úì Validate</button>
        <button class="run-btn" onclick="deployPipeline()">üöÄ Deploy Pipeline</button>
      </div>
    </div>

    <div class="builder-layout">
      <div class="node-palette">
        <div class="palette-section">
          <div class="palette-label">Sources</div>
          <div class="palette-node"><div class="pn-icon" style="background:rgba(0,212,255,0.1)">üóÑ</div>PostgreSQL</div>
          <div class="palette-node"><div class="pn-icon" style="background:rgba(0,212,255,0.1)">‚ùÑ</div>Snowflake</div>
          <div class="palette-node"><div class="pn-icon" style="background:rgba(255,107,53,0.1)">üîå</div>REST API</div>
          <div class="palette-node"><div class="pn-icon" style="background:rgba(255,107,53,0.1)">üìä</div>Google Sheets</div>
          <div class="palette-node"><div class="pn-icon" style="background:rgba(0,255,157,0.1)">üåä</div>Kafka Stream</div>
          <div class="palette-node"><div class="pn-icon" style="background:rgba(255,190,11,0.1)">üìÅ</div>S3 / GCS</div>
        </div>
        <div class="palette-section">
          <div class="palette-label">Transforms</div>
          <div class="palette-node"><div class="pn-icon" style="background:rgba(0,212,255,0.15)">‚ö°</div>Filter / Map</div>
          <div class="palette-node"><div class="pn-icon" style="background:rgba(0,212,255,0.15)">üîó</div>Join / Merge</div>
          <div class="palette-node"><div class="pn-icon" style="background:rgba(0,212,255,0.15)">‚àë</div>Aggregate</div>
          <div class="palette-node"><div class="pn-icon" style="background:rgba(0,255,157,0.15)">ü§ñ</div>AI Enrich</div>
          <div class="palette-node"><div class="pn-icon" style="background:rgba(0,255,157,0.15)">üßπ</div>Deduplicate</div>
          <div class="palette-node"><div class="pn-icon" style="background:rgba(255,107,53,0.15)">üìê</div>Schema Map</div>
        </div>
        <div class="palette-section">
          <div class="palette-label">Destinations</div>
          <div class="palette-node"><div class="pn-icon" style="background:rgba(255,190,11,0.1)">üè≠</div>BigQuery</div>
          <div class="palette-node"><div class="pn-icon" style="background:rgba(255,190,11,0.1)">‚ùÑ</div>Redshift</div>
          <div class="palette-node"><div class="pn-icon" style="background:rgba(0,255,157,0.1)">üì°</div>Webhook</div>
          <div class="palette-node"><div class="pn-icon" style="background:rgba(0,255,157,0.1)">üì®</div>Alert / Notify</div>
        </div>
      </div>

      <div class="canvas-area">
        <div class="canvas-header">
          <span>Pipeline: <strong style="color:var(--text)">Customer 360 ETL</strong></span>
          <div style="display:flex;gap:0.8rem">
            <span id="pipeline-validate-status"></span>
            <span style="color:var(--accent2)">‚óè Auto-saved</span>
          </div>
        </div>
        <div class="canvas-inner">
          <div class="pipeline-canvas">
            <div class="pipeline-flow">
              <div class="p-node running selected" onclick="selectNode('source')" id="node-source">
                <div class="p-node-status-dot psd-running"></div>
                <div class="p-node-icon">üóÑ</div>
                <div class="p-node-name">PostgreSQL</div>
                <div class="p-node-type">Source</div>
              </div>
              <div class="p-arrow"><div class="p-arrow-line active"></div><div class="p-arrow-head"></div></div>
              <div class="p-node" onclick="selectNode('validate')" id="node-validate">
                <div class="p-node-status-dot psd-success"></div>
                <div class="p-node-icon">‚úì</div>
                <div class="p-node-name">Validate</div>
                <div class="p-node-type">Quality Check</div>
              </div>
              <div class="p-arrow"><div class="p-arrow-line active"></div><div class="p-arrow-head"></div></div>
              <div class="p-node" onclick="selectNode('ai-enrich')" id="node-ai-enrich">
                <div class="p-node-status-dot psd-running"></div>
                <div class="p-node-icon">ü§ñ</div>
                <div class="p-node-name">AI Enrich</div>
                <div class="p-node-type">LLM Transform</div>
              </div>
              <div class="p-arrow"><div class="p-arrow-line active"></div><div class="p-arrow-head"></div></div>
              <div class="p-node" onclick="selectNode('join')" id="node-join">
                <div class="p-node-status-dot psd-idle"></div>
                <div class="p-node-icon">üîó</div>
                <div class="p-node-name">Join</div>
                <div class="p-node-type">Merge Orders</div>
              </div>
              <div class="p-arrow"><div class="p-arrow-line"></div><div class="p-arrow-head"></div></div>
              <div class="p-node" onclick="selectNode('dest')" id="node-dest">
                <div class="p-node-status-dot psd-idle"></div>
                <div class="p-node-icon">‚ùÑ</div>
                <div class="p-node-name">Snowflake</div>
                <div class="p-node-type">Destination</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="config-panel" id="config-panel">
        <div class="config-title">‚öô Node Config ‚Äî <span style="color:var(--accent)" id="config-node-name">PostgreSQL Source</span></div>
        <div class="config-field">
          <div class="config-label">Connection String</div>
          <input class="config-input" value="postgresql://prod-db:5432/crm" />
        </div>
        <div class="config-field">
          <div class="config-label">Query / Table</div>
          <input class="config-input" value="SELECT * FROM customers WHERE updated_at > {{last_run}}" />
        </div>
        <div class="config-field">
          <div class="config-label">Batch Size</div>
          <input class="config-input" value="5000" type="number" />
        </div>
        <div class="config-field">
          <div class="config-label">Schedule</div>
          <select class="config-select">
            <option>Every 5 minutes</option>
            <option>Every 15 minutes</option>
            <option>Every hour</option>
            <option>Daily at midnight</option>
            <option>Event-triggered</option>
          </select>
        </div>
        <div class="config-field">
          <div class="config-label">Error Handling</div>
          <select class="config-select">
            <option>Retry 3x then alert</option>
            <option>Skip bad records</option>
            <option>Fail pipeline</option>
            <option>AI auto-repair</option>
          </select>
        </div>
        <button class="ai-suggest-btn" onclick="aiConfigSuggest()">ü§ñ AI Auto-Configure Node</button>
        <div id="ai-config-result" style="margin-top:0.8rem;font-size:0.75rem;color:var(--muted);display:none"></div>
      </div>
    </div>
  </div>

  <!-- ===== AI ASSISTANT TAB ===== -->
  <div class="tab-content" id="tab-ai">
    <div class="hero">
      <div>
        <h1>AI Data <span>Assistant</span></h1>
        <p>Ask anything about your pipelines, data quality, and infrastructure</p>
      </div>
    </div>

    <div class="ai-chat-container">
      <div class="chat-panel">
        <div class="chat-header">
          <div class="ai-avatar">ü§ñ</div>
          <div>
            <div class="chat-title">DataFlow AI</div>
            <div class="chat-subtitle">Claude-powered data engineering expert</div>
          </div>
          <div style="margin-left:auto;display:flex;align-items:center;gap:0.4rem">
            <div class="status-dot" style="background:var(--accent2)"></div>
            <span style="font-size:0.7rem;color:var(--muted)">Connected</span>
          </div>
        </div>

        <div class="chat-messages" id="chat-messages">
          <div class="msg ai">
            <div class="msg-avatar ai-av">ü§ñ</div>
            <div class="msg-bubble">
              Hi! I'm your AI data engineering assistant. I can help you:
              <br><br>
              ‚Ä¢ <strong>Debug pipeline failures</strong> and suggest fixes<br>
              ‚Ä¢ <strong>Generate SQL / dbt models</strong> from plain language<br>
              ‚Ä¢ <strong>Analyze data quality</strong> issues across your warehouse<br>
              ‚Ä¢ <strong>Optimize</strong> slow queries and expensive transforms<br>
              ‚Ä¢ <strong>Write Python</strong> ETL scripts automatically<br><br>
              What would you like to work on today?
            </div>
          </div>
        </div>

        <div class="chat-input-area">
          <div class="suggestion-chips">
            <div class="chip" onclick="sendSuggestion('Why did my Sales pipeline fail last night?')">Pipeline failure?</div>
            <div class="chip" onclick="sendSuggestion('Write a dbt model for monthly revenue rollup by region')">Write dbt model</div>
            <div class="chip" onclick="sendSuggestion('Detect duplicate customer records in my CRM data')">Find duplicates</div>
            <div class="chip" onclick="sendSuggestion('Optimize my Snowflake query for customer LTV calculation')">Optimize query</div>
          </div>
          <div class="input-row">
            <input class="chat-input" id="chat-input" placeholder="Ask about your data pipelines..." onkeydown="handleKey(event)" />
            <button class="send-btn" id="send-btn" onclick="sendMessage()">Send ‚Üó</button>
          </div>
        </div>
      </div>

      <div class="context-panel">
        <div class="card">
          <div class="card-title">Pipeline Context</div>
          <div style="font-size:0.75rem;color:var(--muted);line-height:1.6">
            <div style="color:var(--text);font-weight:600;margin-bottom:0.3rem">Active Data Sources</div>
            PostgreSQL (prod-db) ¬∑ Snowflake ¬∑ Kafka ¬∑ S3
            <div style="color:var(--text);font-weight:600;margin:0.7rem 0 0.3rem">Warehouses</div>
            Snowflake (primary) ¬∑ BigQuery (analytics)
            <div style="color:var(--text);font-weight:600;margin:0.7rem 0 0.3rem">dbt Models</div>
            47 models ¬∑ 12 failing tests today
          </div>
        </div>
        <div class="card">
          <div class="card-title">Recent Issues</div>
          <div style="font-size:0.75rem">
            <div style="padding:0.5rem 0;border-bottom:1px solid var(--border);color:var(--danger)">‚óè Schema drift in orders table</div>
            <div style="padding:0.5rem 0;border-bottom:1px solid var(--border);color:var(--warn)">‚ö† Kafka consumer lag: 45k</div>
            <div style="padding:0.5rem 0;color:var(--accent2)">‚úì NULL values auto-healed</div>
          </div>
        </div>
        <div class="card">
          <div class="card-title">AI Capabilities</div>
          <div style="font-size:0.73rem;color:var(--muted);line-height:1.8">
            ‚ú¶ SQL generation<br>
            ‚ú¶ dbt model scaffolding<br>
            ‚ú¶ Python ETL scripts<br>
            ‚ú¶ Schema analysis<br>
            ‚ú¶ Root cause analysis<br>
            ‚ú¶ Cost optimization<br>
            ‚ú¶ Data lineage mapping
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== ANALYTICS TAB ===== -->
  <div class="tab-content" id="tab-analytics">
    <div class="hero">
      <div>
        <h1>Pipeline <span>Analytics</span></h1>
        <p>Performance insights ¬∑ cost tracking ¬∑ data quality scores</p>
      </div>
    </div>

    <div class="stats-row">
      <div class="stat-card green">
        <div class="stat-label">Data Quality Score</div>
        <div class="stat-value">94.2</div>
        <div class="stat-sub">completeness + accuracy</div>
        <div class="stat-badge badge-up">‚Üë +1.8 this week</div>
      </div>
      <div class="stat-card blue">
        <div class="stat-label">Monthly Data Volume</div>
        <div class="stat-value">84TB</div>
        <div class="stat-sub">processed this month</div>
        <div class="stat-badge badge-up">‚Üë +12% MoM</div>
      </div>
      <div class="stat-card yellow">
        <div class="stat-label">Infra Cost (MTD)</div>
        <div class="stat-value">$2,847</div>
        <div class="stat-sub">est. $3,200 by month-end</div>
        <div class="stat-badge badge-warn">‚Üë +6% over budget</div>
      </div>
      <div class="stat-card orange">
        <div class="stat-label">AI Actions Taken</div>
        <div class="stat-value">142</div>
        <div class="stat-sub">auto-heals this month</div>
        <div class="stat-badge badge-up">‚Üë saved 28hr manual work</div>
      </div>
    </div>

    <div class="analytics-grid">
      <div class="card">
        <div class="card-title">Pipeline Health by Source</div>
        <div id="health-bars"></div>
      </div>
      <div class="card" style="text-align:center">
        <div class="card-title">Overall Quality</div>
        <div class="ring-container" style="height:140px">
          <svg class="ring-svg" width="130" height="130" viewBox="0 0 130 130">
            <circle class="ring-bg" cx="65" cy="65" r="50" stroke-width="12" fill="none"/>
            <circle class="ring-fill" cx="65" cy="65" r="50" stroke-width="12" fill="none"
              stroke="var(--accent2)"
              stroke-dasharray="314"
              stroke-dashoffset="18"
            />
          </svg>
          <div class="ring-center">
            <span class="ring-val" style="color:var(--accent2)">94%</span>
            <span class="ring-lbl">quality</span>
          </div>
        </div>
      </div>
      <div class="card" style="text-align:center">
        <div class="card-title">SLA Compliance</div>
        <div class="ring-container" style="height:140px">
          <svg class="ring-svg" width="130" height="130" viewBox="0 0 130 130">
            <circle class="ring-bg" cx="65" cy="65" r="50" stroke-width="12" fill="none"/>
            <circle class="ring-fill" cx="65" cy="65" r="50" stroke-width="12" fill="none"
              stroke="var(--accent)"
              stroke-dasharray="314"
              stroke-dashoffset="4"
            />
          </svg>
          <div class="ring-center">
            <span class="ring-val" style="color:var(--accent)">98.7%</span>
            <span class="ring-lbl">SLA met</span>
          </div>
        </div>
      </div>
    </div>

    <div class="two-col">
      <div class="card">
        <div class="card-title">AI-Generated Data Lineage Report</div>
        <div style="font-size:0.78rem;line-height:1.7;color:var(--muted)">
          The <strong style="color:var(--text)">customers</strong> table in Snowflake originates from <strong style="color:var(--accent)">PostgreSQL prod-db.crm.contacts</strong>, enriched via AI sentiment analysis on support tickets, and joined with <strong style="color:var(--accent)">Shopify orders</strong> to produce the Customer 360 view.
          <br><br>
          Downstream consumers: <strong style="color:var(--text)">Marketing Attribution Model</strong>, <strong style="color:var(--text)">LTV Prediction Pipeline</strong>, and <strong style="color:var(--text)">Finance Revenue Dashboard</strong>.
          <br><br>
          <span style="color:var(--warn)">‚ö† Alert: </span> Changes to <code style="background:rgba(0,212,255,0.08);padding:0.1rem 0.3rem;border-radius:3px;font-size:0.72rem">crm.contacts.account_tier</code> will affect 3 downstream pipelines and 7 dashboards.
        </div>
      </div>
      <div class="card">
        <div class="card-title">Cost Breakdown by Pipeline</div>
        <div id="cost-breakdown"></div>
      </div>
    </div>
  </div>

</main>

<script>
// --- Tab switching ---
function switchTab(tab) {
  document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(el => el.classList.remove('active'));
  document.getElementById('tab-' + tab).classList.add('active');
  event.target.classList.add('active');
}

// --- Build throughput chart ---
function buildChart() {
  const container = document.getElementById('throughput-chart');
  if (!container) return;
  const values = [30,25,40,35,20,28,45,55,60,70,75,80,72,68,85,90,88,72,60,55,70,82,78,65];
  container.innerHTML = values.map((v, i) => {
    const isRecent = i > 20;
    const color = isRecent ? 'var(--accent)' : 'rgba(0,212,255,0.3)';
    return `<div class="chart-bar" style="height:${v}%;background:${color};min-height:4px" title="${v}% throughput"></div>`;
  }).join('');
}

// --- Build health bars ---
function buildHealthBars() {
  const container = document.getElementById('health-bars');
  if (!container) return;
  const pipelines = [
    { name: 'Sales CRM ‚Üí Snowflake', score: 98, color: 'var(--accent2)' },
    { name: 'Shopify Orders ETL', score: 95, color: 'var(--accent2)' },
    { name: 'Event Stream Analytics', score: 87, color: 'var(--accent)' },
    { name: 'Finance Reconciliation', score: 79, color: 'var(--warn)' },
    { name: 'ML Feature Store Sync', score: 92, color: 'var(--accent)' },
  ];
  container.innerHTML = pipelines.map(p => `
    <div style="margin-bottom:0.9rem">
      <div style="display:flex;justify-content:space-between;font-size:0.73rem;margin-bottom:0.3rem">
        <span>${p.name}</span><span style="color:${p.color};font-family:'Space Mono',monospace">${p.score}%</span>
      </div>
      <div style="background:var(--surface2);border-radius:4px;height:6px;overflow:hidden">
        <div style="width:${p.score}%;height:100%;background:${p.color};border-radius:4px;transition:width 1s ease"></div>
      </div>
    </div>
  `).join('');
}

// --- Build cost breakdown ---
function buildCostBreakdown() {
  const container = document.getElementById('cost-breakdown');
  if (!container) return;
  const items = [
    { name: 'Snowflake compute', cost: '$1,240', pct: 44, color: 'var(--accent)' },
    { name: 'BigQuery queries', cost: '$680', pct: 24, color: 'var(--accent2)' },
    { name: 'S3 storage', cost: '$420', pct: 15, color: 'var(--warn)' },
    { name: 'Kafka streaming', cost: '$310', pct: 11, color: 'var(--accent3)' },
    { name: 'Other infra', cost: '$197', pct: 7, color: 'var(--muted)' },
  ];
  container.innerHTML = items.map(item => `
    <div style="display:flex;align-items:center;gap:0.7rem;margin-bottom:0.65rem">
      <div style="width:8px;height:8px;border-radius:50%;background:${item.color};flex-shrink:0"></div>
      <div style="flex:1;font-size:0.75rem">${item.name}</div>
      <div style="font-size:0.72rem;color:${item.color};font-family:'Space Mono',monospace">${item.cost}</div>
      <div style="width:70px;background:var(--surface2);border-radius:3px;height:4px">
        <div style="width:${item.pct}%;height:100%;background:${item.color};border-radius:3px"></div>
      </div>
    </div>
  `).join('');
}

// --- Live log streaming ---
const logMessages = [
  ['log-info', '[INFO]', "Kafka consumer connected ‚Äî topic: user_events"],
  ['log-success', '[OK]', "dbt model stg_orders compiled in 0.3s"],
  ['log-warn', '[WARN]', "API rate limit at 87% ‚Äî throttling batch size"],
  ['log-info', '[AI]', "Anomaly scan complete ‚Äî no issues detected"],
  ['log-success', '[OK]', "Feature store sync: 48,200 features updated"],
  ['log-info', '[INFO]', "Checkpoint saved ‚Äî offset: 9,182,445"],
  ['log-error', '[ERR]', "Connection timeout on retry 1/3 ‚Äî payments_db"],
  ['log-warn', '[WARN]', "NULL rate in revenue_usd exceeded 2% threshold"],
  ['log-success', '[OK]', "Auto-heal applied: NULL values backfilled via lookup"],
  ['log-info', '[AI]', "Schema drift detected in orders ‚Äî mapping updated automatically"],
];
let logIdx = 0;

function addLogLine() {
  const logArea = document.getElementById('live-logs');
  if (!logArea) return;
  const now = new Date();
  const time = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
  const [cls, tag, msg] = logMessages[logIdx % logMessages.length];
  const line = document.createElement('div');
  line.className = 'log-line';
  line.innerHTML = `<span class="log-time">${time}</span><span class="${cls}">${tag}</span><span>${msg}</span>`;
  logArea.appendChild(line);
  logArea.scrollTop = logArea.scrollHeight;
  logIdx++;
}

setInterval(addLogLine, 3000);

// --- Dashboard run all ---
function triggerRun() {
  const btn = event.target;
  btn.textContent = '‚ü≥ Running...';
  btn.disabled = true;
  setTimeout(() => {
    btn.textContent = '‚úì All Started';
    btn.style.background = 'linear-gradient(135deg, var(--accent2), #00cc7a)';
    setTimeout(() => {
      btn.textContent = '‚ñ∂ Run All Pipelines';
      btn.style.background = '';
      btn.disabled = false;
    }, 3000);
  }, 1500);
}

// --- Optimization apply ---
function applyOptimization(btn) {
  const original = btn.textContent;
  btn.textContent = '‚ü≥ Applying...';
  btn.disabled = true;
  setTimeout(() => {
    btn.textContent = '‚úì Applied!';
    btn.style.color = 'var(--accent2)';
    btn.style.borderColor = 'rgba(0,255,157,0.3)';
  }, 1500);
}

// --- Pipeline builder ---
function selectNode(id) {
  document.querySelectorAll('.p-node').forEach(n => n.classList.remove('selected'));
  document.getElementById('node-' + id)?.classList.add('selected');
  const names = {
    source: 'PostgreSQL Source',
    validate: 'Schema Validator',
    'ai-enrich': 'AI Enrichment Node',
    join: 'Join / Merge',
    dest: 'Snowflake Destination'
  };
  const el = document.getElementById('config-node-name');
  if (el) el.textContent = names[id] || id;
}

function validatePipeline() {
  const el = document.getElementById('pipeline-validate-status');
  el.textContent = '‚ü≥ Validating...';
  el.style.color = 'var(--muted)';
  setTimeout(() => {
    el.textContent = '‚úì Pipeline Valid';
    el.style.color = 'var(--accent2)';
  }, 1800);
}

function deployPipeline() {
  const btn = event.target;
  btn.textContent = '‚ü≥ Deploying...';
  btn.disabled = true;
  setTimeout(() => {
    btn.textContent = '‚úì Deployed!';
    btn.style.background = 'linear-gradient(135deg, var(--accent2), #00cc7a)';
    setTimeout(() => {
      btn.textContent = 'üöÄ Deploy Pipeline';
      btn.style.background = '';
      btn.disabled = false;
    }, 3000);
  }, 2000);
}

function aiConfigSuggest() {
  const btn = event.target;
  const result = document.getElementById('ai-config-result');
  btn.textContent = '‚ü≥ AI analyzing...';
  btn.disabled = true;
  result.style.display = 'none';
  setTimeout(() => {
    result.style.display = 'block';
    result.innerHTML = `<div style="background:rgba(0,212,255,0.05);border:1px solid rgba(0,212,255,0.15);border-radius:7px;padding:0.7rem;font-size:0.74rem;color:var(--text);line-height:1.6">
      <div class="ai-label">AI SUGGESTION</div>
      <strong>Recommended config based on your data pattern:</strong><br>
      ‚Ä¢ Batch size: <code style="color:var(--accent)">10,000</code> (your rows avg 400 bytes)<br>
      ‚Ä¢ Add watermark on <code style="color:var(--accent)">updated_at</code> for incremental loads<br>
      ‚Ä¢ Enable connection pooling (max_pool=5)<br>
      ‚Ä¢ Schedule: every 5 min during business hours, 30 min overnight
    </div>`;
    btn.textContent = 'ü§ñ AI Auto-Configure Node';
    btn.disabled = false;
  }, 2000);
}

// --- AI Chat ---
const CLAUDE_RESPONSES = {
  "pipeline failure": `I analyzed your pipeline logs. The **Sales CRM pipeline** failed at **02:14 AM** due to a schema change in the Salesforce \`Opportunity\` object ‚Äî a new field \`contract_value_usd\` was added that isn't mapped in your current dbt model.

**Root Cause:** The \`stg_salesforce_opportunities\` model expects exactly 31 columns but received 32.

**Fix:**
\`\`\`sql
-- Add to stg_salesforce_opportunities.sql
, COALESCE(contract_value_usd, 0) AS contract_value_usd
\`\`\`

I can automatically update the dbt model and re-run the pipeline. Want me to proceed?`,

  "dbt model": `Here's a dbt model for monthly revenue rollup by region:

\`\`\`sql
-- models/marts/finance/monthly_revenue_by_region.sql
WITH orders AS (
  SELECT * FROM {{ ref('stg_shopify_orders') }}
  WHERE status = 'completed'
),
aggregated AS (
  SELECT
    DATE_TRUNC('month', created_at)   AS month,
    shipping_country                   AS region,
    COUNT(*)                           AS order_count,
    SUM(total_price)                   AS gross_revenue,
    SUM(discount_amount)               AS total_discounts,
    SUM(total_price - discount_amount) AS net_revenue
  FROM orders
  GROUP BY 1, 2
)
SELECT
  month,
  region,
  order_count,
  gross_revenue,
  total_discounts,
  net_revenue,
  net_revenue / NULLIF(gross_revenue, 0) AS net_margin_pct
FROM aggregated
ORDER BY month DESC, net_revenue DESC
\`\`\`

Add to \`schema.yml\` with tests: \`unique\`, \`not_null\` on (month, region), and \`accepted_values\` for region codes.`,

  "duplicate": `To detect duplicate customer records, run this deduplication analysis:

\`\`\`sql
-- Find duplicates by email + phone
SELECT
  email,
  phone,
  COUNT(*) as duplicate_count,
  MIN(created_at) as first_seen,
  MAX(created_at) as last_seen,
  ARRAY_AGG(customer_id) as all_ids
FROM {{ ref('stg_crm_customers') }}
GROUP BY email, phone
HAVING COUNT(*) > 1
ORDER BY duplicate_count DESC;
\`\`\`

I found **1,847 potential duplicates** in your CRM data based on fuzzy email matching. I recommend keeping the oldest record and merging activity history. I can generate the full deduplication pipeline automatically.`,

  "optimize": `I analyzed your Snowflake query for customer LTV. Here are optimizations:

**Issues found:**
‚Ä¢ Full table scan on 240M row \`events\` table
‚Ä¢ Missing clustering key on \`customer_id\`  
‚Ä¢ Cartesian join risk in subquery

**Optimized query:**
\`\`\`sql
-- Add clustering key first:
ALTER TABLE events CLUSTER BY (customer_id, DATE_TRUNC('month', event_ts));

-- Then rewrite the LTV calc:
SELECT
  c.customer_id,
  c.email,
  SUM(o.revenue) AS total_ltv,
  COUNT(DISTINCT o.order_id) AS order_count
FROM customers c
INNER JOIN orders o USING (customer_id)
WHERE o.created_at >= DATEADD('year', -2, CURRENT_DATE)
GROUP BY 1, 2
\`\`\`

Estimated improvement: **~73% faster**, $0.40 ‚Üí $0.11 per query.`
};

function getAIResponse(msg) {
  const lower = msg.toLowerCase();
  if (lower.includes('fail') || lower.includes('error')) return CLAUDE_RESPONSES["pipeline failure"];
  if (lower.includes('dbt') || lower.includes('revenue') || lower.includes('model')) return CLAUDE_RESPONSES["dbt model"];
  if (lower.includes('duplic')) return CLAUDE_RESPONSES["duplicate"];
  if (lower.includes('optim') || lower.includes('query') || lower.includes('slow') || lower.includes('ltv')) return CLAUDE_RESPONSES["optimize"];
  return `I analyzed your request. Based on your current pipeline configuration and data patterns, here's what I found:\n\nYour data infrastructure is processing **2.4M records/day** with a **98.7% success rate**. I can see 3 active pipelines and 2 pending quality alerts.\n\nCould you be more specific? For example:\n‚Ä¢ "Why did X pipeline fail?"\n‚Ä¢ "Write a SQL query for Y"\n‚Ä¢ "Optimize my Z transform"\n\nI have full context of your Snowflake, PostgreSQL, and Kafka sources.`;
}

function renderMessage(role, text) {
  const msgs = document.getElementById('chat-messages');
  const div = document.createElement('div');
  div.className = `msg ${role}`;
  const avatarClass = role === 'ai' ? 'ai-av' : 'user-av';
  const avatarContent = role === 'ai' ? 'ü§ñ' : 'üë§';
  // Format code blocks
  let html = text
    .replace(/```(\w+)?\n?([\s\S]*?)```/g, '<pre>$2</pre>')
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    .replace(/\n/g, '<br>');
  div.innerHTML = `
    <div class="msg-avatar ${avatarClass}">${avatarContent}</div>
    <div class="msg-bubble">${html}</div>
  `;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

function showTyping() {
  const msgs = document.getElementById('chat-messages');
  const div = document.createElement('div');
  div.className = 'msg ai';
  div.id = 'typing-indicator';
  div.innerHTML = `
    <div class="msg-avatar ai-av">ü§ñ</div>
    <div class="msg-bubble"><div class="typing"><span></span><span></span><span></span></div></div>
  `;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

function removeTyping() {
  document.getElementById('typing-indicator')?.remove();
}

function sendMessage() {
  const input = document.getElementById('chat-input');
  const msg = input.value.trim();
  if (!msg) return;
  input.value = '';
  renderMessage('user', msg);
  document.getElementById('send-btn').disabled = true;
  showTyping();
  const delay = 1200 + Math.random() * 800;
  setTimeout(() => {
    removeTyping();
    renderMessage('ai', getAIResponse(msg));
    document.getElementById('send-btn').disabled = false;
    input.focus();
  }, delay);
}

function sendSuggestion(text) {
  const input = document.getElementById('chat-input');
  input.value = text;
  sendMessage();
}

function handleKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
}

// --- Init ---
buildChart();
buildHealthBars();
buildCostBreakdown();

// Animate stat numbers
setTimeout(() => {
  let n = 0;
  const target = 2.4;
  const el = document.getElementById('stat-records');
  const iv = setInterval(() => {
    n += 0.1;
    if (n >= target) { clearInterval(iv); return; }
    el.textContent = n.toFixed(1) + 'M';
  }, 50);
}, 300);
</script>
</body>
</html>
